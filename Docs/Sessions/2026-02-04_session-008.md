# Session 2026-02-04 - session-008 (Student Scanner QR + Attendance Submit)

## Goals
- Implement mobile_scanner QR scan
- Submit attendance via submitAttendance function

## Context
- PRD: student scans token; success shows 'Presence enregistree a {heure}'

## Atomic Tasks
1) Implement Scanner QR page with camera permission handling -- DONE:
   - Camera permission added to AndroidManifest.xml
   - mobile_scanner 7.1.4 with QR-only format filter
   - Scan frame overlay with gold border + hint text
   - Camera error builder with French permission message
   - DetectionSpeed.noDuplicates to prevent multiple scans
2) Parse QR payload and call submitAttendance -- DONE:
   - JSON decode of {classId, sessionId, token}
   - Validation of required fields
   - callSubmitAttendance() added to attendance_providers.dart
   - Sends clientScannedAt timestamp
3) Show success UI with checkedAt time (server) -- DONE:
   - Green circle checkmark
   - "Presence enregistree" heading
   - "a HH:MM" from server checkedAt (parsed + localized)
   - "Retour" button to pop back
4) Show error states in French -- DONE:
   - QR code invalide (malformed JSON or missing fields)
   - Presence deja enregistree (already-exists)
   - Session expiree (deadline-exceeded)
   - Token invalide (permission-denied)
   - Session introuvable (not-found)
   - N'appartenez pas a cette classe
   - Authentification requise
   - Generic fallback with raw error
   - "Reessayer" button resets scanner; "Retour" button pops
5) Updated student view in attendance_page.dart -- DONE:
   - Replaced placeholder with scanner icon, description, and "Scanner QR" button
   - Navigation to QrScannerPage on tap

## Tests
- flutter analyze: 0 issues
- flutter test: 1 test passed

## Errors
- None

## Outputs
Files created:
- lib/features/attendance/qr_scanner_page.dart (scanner + submit + success/error states)

Files modified:
- lib/features/attendance/attendance_page.dart (student view: scanner button + navigation)
- lib/features/attendance/attendance_providers.dart (added callSubmitAttendance)
- android/app/src/main/AndroidManifest.xml (added CAMERA permission + feature)

## Next Steps
- Session-009: Schedule (today/week) and assessments (today/week) UI + queries
