# Session 2026-02-04 - session-014 (Settings: Photo, Email, Logout)

## Goals
- Implement Parametres screen
- Support profile photo upload and email change

## Context
- PRD: change photo (Storage), change email (Auth), logout; identity fields immutable

## Atomic Tasks
1) Build Parametres screen -- DONE:
   - Display immutable fields (fullName, personalNumber, role, class/classes)
   - Profile photo with avatar and camera edit button
   - Email field with edit button (opens change dialog)
   - Logout button with confirmation dialog
2) Implement photo picker + upload to Storage -- DONE:
   - pickAndUploadProfilePhoto(): picks from gallery, resizes to 512x512, uploads to Storage
   - Storage path: /users/{uid}/profile.{ext}
   - Updates photoURL in Firestore users/{uid}
3) Implement email change flow -- DONE:
   - updateEmail(): requires reauthentication with current password
   - Uses verifyBeforeUpdateEmail() for secure flow
   - French error messages for common errors (wrong-password, email-already-in-use)
4) Storage security rules -- ALREADY DONE (session-005):
   - /users/{userId}/profile.{ext}: user can read/write own photo
   - Size limit: 5MB
   - Content type: image/*

## Tests
- flutter analyze: 0 issues
- flutter test: 1 test passed

## Errors
- None

## Outputs
Files created:
- lib/features/settings/settings_providers.dart (pickAndUploadProfilePhoto, updateEmail, syncEmailToFirestore, fetchClassName, fetchTeacherClassNames)

Files modified:
- pubspec.yaml (added image_picker: ^1.1.2)
- lib/features/settings/settings_page.dart (rewrote from placeholder to full settings screen)

## Next Steps
- Session-015: Seeding scripts + verification and docs
